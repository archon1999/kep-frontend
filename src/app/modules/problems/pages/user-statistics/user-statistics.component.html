<app-content-header [contentHeader]="contentHeader"/>

@if (isLoading) {
  <kep-card class="mb-1">
    <div class="card-body d-flex justify-content-center align-items-center" [style.minHeight.px]="400">
      <spinner></spinner>
    </div>
  </kep-card>
} @else if (statistics) {
  <div class="row">
    @for (card of overviewCards; track card.titleKey) {
      <div class="col-12 col-sm-6 col-lg-3">
        <kep-card>
          <div class="card-header">
            <div class="card-title">
              <kep-icon [name]="card.icon"></kep-icon>
              {{ card.titleKey | translate }}
            </div>
          </div>
          <div class="card-body d-flex align-items-center gap-1">
            <div class="flex-grow-1">
              <div class="fw-bold display-6">
                @if (card.isNumber) {
                  {{ card.value | number }}
                } @else {
                  {{ card.value }}
                }
              </div>
              @if (card.subtitle) {
                <div class="text-muted">{{ card.subtitle }}</div>
              }
            </div>
          </div>
        </kep-card>
      </div>
    }
  </div>

  <div class="row">
    <div class="col-xl-4">
      <widget-profile
        [username]="username"
        [general]="statistics.general"
        [langs]="statistics.byLang"
        [tags]="statistics.byTag"
        [topics]="statistics.byTopic"
      ></widget-profile>
    </div>
    <div class="col-xl-8">
      <div class="row">
        <div class="col-12">
          <widget-activity
            [solved]="statistics.lastDays?.solved ?? 0"
            [series]="statistics.lastDays?.series ?? []"
            [selectedDays]="selectedDays ?? statistics.meta?.lastDays ?? 7"
            [allowedDays]="availableDays?.length ? availableDays : (statistics.meta?.allowedLastDays ?? [7,14,30])"
            (daysChange)="handleDaysChange($event)"
          ></widget-activity>
        </div>
        <div class="col-lg-6">
          <widget-difficulties [data]="statistics.byDifficulty"></widget-difficulties>
        </div>
        <div class="col-lg-6">
          <widget-facts [facts]="statistics.facts"></widget-facts>
        </div>
        <div class="col-12">
          <widget-heatmap
            [heatmap]="statistics.heatmap"
            [selectedYear]="selectedYear"
            [availableYears]="availableYears"
            (yearChange)="handleYearChange($event)"
          ></widget-heatmap>
        </div>
        <div class="col-12">
          <widget-time
            [byWeekday]="statistics.byWeekday"
            [byMonth]="statistics.byMonth"
            [byPeriod]="statistics.byPeriod"
          ></widget-time>
        </div>
        <div class="col-12">
          <widget-attempts-for-solve
            [numberOfAttempts]="statistics.numberOfAttempts"
          ></widget-attempts-for-solve>
        </div>
      </div>
    </div>
  </div>
}
