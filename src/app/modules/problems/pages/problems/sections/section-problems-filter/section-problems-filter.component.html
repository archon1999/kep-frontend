<kep-card customClass="problems-filter">
  <div class="card-body">
    <form [formGroup]="filterForm">
      <div class="problems-filter__header">
        <div class="problems-filter__title">
          <kep-icon name="filter"></kep-icon>
          <span>{{ 'Filter' | translate }}</span>
          <span class="problems-filter__count">({{ problemsCount }})</span>
        </div>
        <div class="problems-filter__actions">
          <button type="button" class="btn btn-icon btn-sm btn-outline-primary" (click)="filterCollapsed = !filterCollapsed">
            <kep-icon [name]="filterCollapsed ? 'double-up' : 'double-down'"></kep-icon>
          </button>
        </div>
      </div>

      <div class="problems-filter__grid">
        <div class="problems-filter__field problems-filter__field--search">
          <kep-icon name="search"></kep-icon>
          <input
            type="search"
            class="form-control"
            formControlName="title"
            [placeholder]="'Search' | translate"
          />
        </div>

        <div class="problems-filter__field">
          <ng-select
            appendTo="body"
            formControlName="tags"
            [multiple]="true"
            [closeOnSelect]="false"
            [items]="tags"
            [groupBy]="'category'"
            [bindLabel]="'name'"
            [bindValue]="'id'"
            placeholder="{{ 'TAGS' | translate }}"
            [compareWith]="compareEqual">
            <ng-template ng-optgroup-tmp let-item="item">
              {{ item.category }}
            </ng-template>
          </ng-select>
        </div>

        <div class="problems-filter__field">
          <ng-select
            appendTo="body"
            formControlName="difficulty"
            [searchable]="false"
            placeholder="{{ 'DIFFICULTY' | translate }}"
            [compareWith]="compareEqual">
            @for (item of difficulties; track item) {
              <ng-option [value]="item.value">
                <span class="text-{{ item.value | problemDifficultyColor }}">
                  {{ item.name }}
                </span>
              </ng-option>
            }
          </ng-select>
        </div>

        <div class="problems-filter__field">
          <ng-select
            appendTo="body"
            formControlName="status"
            [searchable]="false"
            placeholder="{{ 'STATUS' | translate }}"
            [compareWith]="compareEqual">
            <ng-option [value]="3">
              <kep-icon name="minus" class="text-warning"></kep-icon>
              {{ 'Unknown' | translate }}
            </ng-option>
            <ng-option [value]="1">
              <kep-icon name="check" class="text-success"></kep-icon>
              {{ 'Solved' | translate }}
            </ng-option>
            <ng-option [value]="2">
              <kep-icon name="cross" class="text-danger"></kep-icon>
              {{ 'Unsolved' | translate }}
            </ng-option>
          </ng-select>
        </div>
      </div>

      <div class="problems-filter__advanced" *ngIf="filterCollapsed">
        <div class="problems-filter__grid problems-filter__grid--advanced">
          <div class="problems-filter__field">
            <ng-select
              appendTo="body"
              formControlName="hasChecker"
              [compareWith]="compareEqual"
              placeholder="{{ 'Checker' | translate }}">
              <ng-option [value]="true">
                <i [data-feather]="'exists' | iconName" class="text-success"></i>
                {{ 'Yes' | translate }}
              </ng-option>
              <ng-option [value]="false">
                <i [data-feather]="'not_exists' | iconName" class="text-danger"></i>
                {{ 'No' | translate }}
              </ng-option>
            </ng-select>
          </div>

          <div class="problems-filter__field">
            <ng-select
              appendTo="body"
              formControlName="hasCheckInput"
              [compareWith]="compareEqual"
              placeholder="{{ 'CheckInput' | translate }}">
              <ng-option [value]="true">
                <i [data-feather]="'exists' | iconName" class="text-success"></i>
                {{ 'Yes' | translate }}
              </ng-option>
              <ng-option [value]="false">
                <i [data-feather]="'not_exists' | iconName" class="text-danger"></i>
                {{ 'No' | translate }}
              </ng-option>
            </ng-select>
          </div>

          <div class="problems-filter__field">
            <ng-select
              appendTo="body"
              formControlName="hasSolution"
              [compareWith]="compareEqual"
              placeholder="{{ 'Solution' | translate }}">
              <ng-option [value]="true">
                <i [data-feather]="'exists' | iconName" class="text-success"></i>
                {{ 'Yes' | translate }}
              </ng-option>
              <ng-option [value]="false">
                <i [data-feather]="'not_exists' | iconName" class="text-danger"></i>
                {{ 'No' | translate }}
              </ng-option>
            </ng-select>
          </div>

          <div class="problems-filter__field">
            <ng-select
              appendTo="body"
              formControlName="partialSolvable"
              [compareWith]="compareEqual"
              placeholder="{{ 'PartialSolvable' | translate }}">
              <ng-option [value]="true">
                <i [data-feather]="'exists' | iconName" class="text-success"></i>
                {{ 'Yes' | translate }}
              </ng-option>
              <ng-option [value]="false">
                <i [data-feather]="'not_exists' | iconName" class="text-danger"></i>
                {{ 'No' | translate }}
              </ng-option>
            </ng-select>
          </div>
        </div>
      </div>
    </form>
  </div>
</kep-card>

<ng-select-css></ng-select-css>
